# Pixiv うごイラ GIFダウンローダー Chrome拡張機能 要件定義書

## 1. プロジェクト概要

### 1.1 目的
Pixivのうごイラ（動くイラスト）をワンクリックでGIF形式に変換してダウンロードできるChrome拡張機能を開発する。

### 1.2 背景
- Pixivのうごイラは独自形式（ZIPアーカイブ + animation.json）で提供される
- 標準では直接GIF形式でのダウンロードができない
- 既存のツールは複数ステップが必要で使いにくい

## 2. 機能要件

### 2.1 必須機能

#### 2.1.1 うごイラ検出機能
- Pixivのうごイラページを自動検出
- うごイラ作品のIDを取得
- 作品ページ上にダウンロードボタンを表示

#### 2.1.2 ダウンロード機能
- ワンクリックでGIF形式に変換してダウンロード
- オリジナル品質（1920x1080）のフレームを使用
- フレーム間隔を正確に再現（animation.jsonの情報を使用）

#### 2.1.3 進捗表示機能
- ダウンロード進捗をユーザーに表示
- エラー時には適切なエラーメッセージを表示

### 2.2 オプション機能（将来実装）

#### 2.2.1 品質設定
- ダウンロード品質の選択（600x600 / 1920x1080）
- GIFの最適化オプション（ファイルサイズ削減）

#### 2.2.2 バッチダウンロード
- 複数のうごイラを一括ダウンロード
- ブックマークページからの一括ダウンロード

#### 2.2.3 形式選択
- MP4形式でのダウンロードオプション
- WebM形式でのダウンロードオプション

## 3. 非機能要件

### 3.1 パフォーマンス
- ZIPファイルの取得から変換完了まで30秒以内
- メモリ使用量を最小限に抑える（ストリーミング処理）

### 3.2 ユーザビリティ
- 直感的なUI（ワンクリック操作）
- 日本語・英語対応
- ダークモード対応

### 3.3 セキュリティ
- Content Security Policy (CSP) 準拠
- Manifest V3のセキュリティ要件を満たす
- 最小限の権限要求

### 3.4 互換性
- Chrome 110以降をサポート
- Edge、Brave等のChromiumベースブラウザで動作

## 4. 技術仕様

### 4.1 うごイラデータ構造
```
- ZIPアーカイブ: 複数のJPEG/PNGフレーム
- animation.json: フレーム間隔情報
  {
    "frames": [
      {"file": "000000.jpg", "delay": 100},
      {"file": "000001.jpg", "delay": 100},
      ...
    ]
  }
```

### 4.2 APIエンドポイント
- ZIPファイルURL: `https://i.pximg.net/img-zip-ugoira/img/{date}/{id}_ugoira{resolution}.zip`
- 解像度オプション: 600x600, 1920x1080

### 4.3 必要な権限
- `activeTab`: 現在のタブへのアクセス
- `storage`: 設定の保存
- `downloads`: ファイルダウンロード
- `host permissions`: `*.pixiv.net`, `*.pximg.net`

## 5. 制約事項

### 5.1 技術的制約
- Manifest V3準拠（background scriptsの代わりにservice workerを使用）
- リモートコードの実行不可
- 同期XMLHttpRequestの使用不可

### 5.2 法的制約
- 著作権を尊重し、個人利用の範囲での使用を推奨
- Pixivの利用規約に準拠

### 5.3 リソース制約
- Chrome Web Storeのファイルサイズ制限（10MB以下）
- Service Workerの実行時間制限（5分）

## 6. 想定ユーザー

### 6.1 主要ユーザー
- Pixivのアクティブユーザー
- うごイラをローカルに保存したいユーザー
- GIF形式で他のプラットフォームに共有したいユーザー

### 6.2 ユーザースキル
- 基本的なブラウザ操作ができる
- Chrome拡張機能のインストールができる

## 7. 成功指標

### 7.1 機能面
- うごイラの95%以上で正常にGIF変換・ダウンロードが可能
- 変換品質の劣化が最小限

### 7.2 パフォーマンス面
- 10MBのうごイラを30秒以内に処理
- メモリ使用量500MB以下

### 7.3 ユーザビリティ面
- インストールから使用開始まで3クリック以内
- エラー率5%以下

## 8. リスクと対策

### 8.1 技術的リスク
- **リスク**: Pixiv APIの仕様変更
- **対策**: エラーハンドリングの実装、定期的な動作確認

### 8.2 法的リスク
- **リスク**: 著作権侵害の助長
- **対策**: 利用規約での注意喚起、個人利用の推奨

### 8.3 パフォーマンスリスク
- **リスク**: 大容量うごイラでのメモリ不足
- **対策**: ストリーミング処理、チャンク単位での処理

## 9. 開発スケジュール概要

1. **Phase 1 (MVP)**: 基本的なダウンロード機能
2. **Phase 2**: UI改善、エラーハンドリング強化
3. **Phase 3**: オプション機能の実装

## 10. 今後の拡張可能性

- Pixiv以外のサイトへの対応
- 動画編集機能の追加
- クラウドストレージへの直接保存